import{r as J}from"./vendor-@tracespace-_ibhTgpc.js";import{r as Q}from"./vendor-gerber-parser-ClboYFFq.js";import{r as V}from"./vendor-gerber-plotter-BPlChmpN.js";import{r as Y}from"./vendor-xml-element-string-4eagscF3.js";import{r as Z}from"./vendor-readable-stream-Bo7DI6DN.js";import{r as $}from"./vendor-inherits-BICa84dG.js";import{r as rr}from"./vendor-lodash.isfinite-1y0ymm8B.js";var B={exports:{}},I,D;function q(){if(D)return I;D=1;var m=function(n){return Math.round(1e10*n)/1e7},a=function(n,v,k){return k("rect",{x:m(n[0]),y:m(n[1]),width:m(n[2]-n[0]),height:m(n[3]-n[1]),fill:v})},y=function(n,v,k){var t="url(#"+n+")";return k("g",{mask:t},v)},b=function(n,v,k,t){k=[a(v,"#fff",t)].concat(k);var r={id:n,fill:"#000",stroke:"#000"};return t("mask",r,[t("g",{},k)])};return I={shift:m,maskLayer:y,createMask:b},I}var R,N;function er(){if(N)return R;N=1;var m=q(),a=m.shift,y=m.createMask,b=m.maskLayer,n=function(o,d,c){return{tag:o,attr:d,children:c||[]}},v=function(o,d,c,l){var _={cx:a(o),cy:a(d),r:a(c)};return l!=null&&(_["stroke-width"]=a(l),_.fill="none"),n("circle",_)},k=function(o,d,c,l,_){var i={x:a(o-l/2),y:a(d-_/2),width:a(l),height:a(_)};return c&&(i.rx=a(c),i.ry=a(c)),n("rect",i)},t=function(o){var d=o.map(function(c){return c.map(a).join(",")}).join(" ");return n("polygon",{points:d})},r=function(o,d,c,l,_){var i=o+"mask-"+d,e="url(#"+i+")",h=v(l.cx,l.cy,l.r,l.width),f=_("mask",{id:i,stroke:"#fff"},[_(h.tag,h.attr)]),u=c.map(function(s){var w=s.type==="rect"?k(s.cx,s.cy,s.r,s.width,s.height):t(s.points);return _(w.tag,w.attr)}),p=n("g",{mask:e},u);return{mask:f,layer:p}};return R=function(d,c,l,_){var i=d+"_pad-"+c,e=i+"_",h=l.reduce(function(f,u,p){var s;switch(u.type){case"circle":s=v(u.cx,u.cy,u.r);break;case"ring":s=v(u.cx,u.cy,u.r,u.width);break;case"rect":s=k(u.cx,u.cy,u.r,u.width,u.height);break;case"poly":s=t(u.points);break;case"clip":var w=r(e,p,u.shape,u.clip,_);f.masks.push(w.mask),s=w.layer;break;case"layer":if(f.count++,f.last=u.polarity,u.polarity==="clear"){var g=e+f.count;f.maskId=g,f.maskBox=u.box.slice(0),f.maskChildren=[],f.layers=[b(g,f.layers,_)]}else{var C=y(f.maskId,f.maskBox,f.maskChildren,_);f.masks.push(C)}break}if(s){l.length===1&&(s.attr.id=i);var P=_(s.tag,s.attr,s.children);f.last==="dark"?f.layers.push(P):f.maskChildren.push(P)}return f},{count:0,last:"dark",layers:[],maskId:"",maskBox:[],maskChildren:[],masks:[]});return h.last==="clear"&&h.masks.push(y(h.maskId,h.maskBox,h.maskChildren,_)),l.length>1&&(h.layers=_("g",{id:i},h.layers)),h.masks.concat(h.layers)},R}var T,K;function tr(){if(K)return T;K=1;var m=q(),a=m.shift;return T=function(b,n,v,k,t){var r="#"+b+"_pad-"+n;return t("use",{"xlink:href":r,x:a(v),y:a(k)})},T}var O,F;function ar(){if(F)return O;F=1;var m=q(),a=m.shift,y=function(t,r){return t[0]===r[0]&&t[1]===r[1]},b=function(t){return"M "+a(t[0])+" "+a(t[1])},n=function(t,r){var o=t==="L"||t==="M"?"":"L ";return o+a(r[0])+" "+a(r[1])},v=function(t,r,o,d,c,l){if(o===0)return n(t,c);if(o===2*Math.PI){var _=[2*l[0]-c[0],2*l[1]-c[1]],i=v(t,r,Math.PI,d,_,l),e=v("A",r,Math.PI,d,c,l);return i+" "+e}var h=t==="A"?"":"A ";return r=a(r),h+=r+" "+r+" 0 ",h+=o>Math.PI?"1 ":"0 ",h+=d==="ccw"?"1 ":"0 ",h+=a(c[0])+" "+a(c[1]),h},k=function(t,r){var o=r.type,d=r.start,c=r.end;return y(t.last,d)||(t.data+=(t.data?" ":"")+b(d),t.lastCmd="M"),t.data+=" ",o==="line"?(t.data+=n(t.lastCmd,c),t.lastCmd="L"):(t.data+=v(t.lastCmd,r.radius,r.sweep,r.dir,c,r.center),t.lastCmd="A"),t.last=c,t};return O=function(r,o,d){var c=r.reduce(k,{last:[],data:""}).data,l={d:c};return o!=null&&(l.fill="none",l["stroke-width"]=a(o)),d("path",l)},O}var j,G;function H(){if(G)return j;G=1;var m=Y();return j=function(a,y,b){var n=b||m,v={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"0","fill-rule":"evenodd",width:a.width+a.units,height:a.height+a.units,viewBox:a.viewBox.join(" ")};typeof y=="string"&&(y={id:y}),Object.keys(y||{}).forEach(function(o){var d=y[o];d!=null&&(v[o]=d)});var k=[];if(a.layer.length){a.defs.length&&k.push(n("defs",{},a.defs));var t=a.viewBox[3]+2*a.viewBox[1],r="translate(0,"+t+") scale(1,-1)";k.push(n("g",{transform:r,fill:"currentColor",stroke:"currentColor"},a.layer))}return n("svg",v,k)},j}var A,U;function ir(){if(U)return A;U=1;var m=Z().Transform,a=$(),y=rr(),b=er(),n=tr(),v=ar(),k=q(),t=H(),r=k.shift,o=k.maskLayer,d=k.createMask,c=0,l=1,_=2,i=function(e,h,f,u){m.call(this,{writableObjectMode:!0,readableObjectMode:u}),this.id=e,this.attributes=h,this.defs=[],this.layer=[],this.viewBox=[0,0,0,0],this.width=0,this.height=0,this.units="",this._maskId="",this._maskBox=[],this._mask=[],this._blockMode=!1,this._blockBox=[],this._block=[],this._blockCount=0,this._blockLayerCount=0,this._offsets=[],this._clearCount=0,this._lastLayer=0,this._blockCount=0,this._blockCount=0,this._element=f};return a(i,m),i.prototype._transform=function(e,h,f){switch(e.type){case"shape":this.defs=this.defs.concat(b(this.id,e.tool,e.shape,this._element));break;case"pad":this._draw(n(this.id,e.tool,e.x,e.y,this._element));break;case"fill":this._draw(v(e.path,null,this._element));break;case"stroke":this._draw(v(e.path,e.width,this._element));break;case"polarity":this._handleNewPolarity(e.polarity,e.box);break;case"repeat":this._handleNewRepeat(e.offsets,e.box);break;case"size":this._handleSize(e.box,e.units)}f()},i.prototype._flush=function(e){this._handleNewRepeat([]),this.push(t(this,this.attributes,this._element)),e()},i.prototype._finishBlockLayer=function(){if(this._block.length){this._blockLayerCount++;var e=this.id+"_block-"+this._blockCount+"-"+this._blockLayerCount;this.defs.push(this._element("g",{id:e},this._block)),this._block=[]}},i.prototype._finishClearLayer=function(){return this._maskId?(this.defs.push(d(this._maskId,this._maskBox,this._mask,this._element)),this._maskId="",this._maskBox=[],this._mask=[],!0):!1},i.prototype._handleNewPolarity=function(e,h){if(this._blockMode)return this._blockLayerCount===0&&!this._block.length&&(this._blockMode=e==="dark"?l:_),this._finishBlockLayer();this._clearCount=e==="clear"?this._clearCount+1:this._clearCount;var f=this.id+"_clear-"+this._clearCount;e==="clear"?(this.layer=[o(f,this.layer,this._element)],this._maskId=f,this._maskBox=h.slice(0)):this._finishClearLayer(h)},i.prototype._handleNewRepeat=function(e,h){var f=e.length===0,u=this._finishClearLayer();this._finishBlockLayer();var p=this.layer,s=this._element,w=this._blockMode,g=this._blockLayerCount,C=this.id+"_block-"+this._blockCount+"-";if(this._offsets.forEach(function(M){for(var x=w;x<=g;x+=2)p.push(s("use",{"xlink:href":"#"+C+x,x:r(M[0]),y:r(M[1])}))}),g>2-w){var P=C+"clear";this.layer=[o(P,p,this._element)],this._maskId=P,this._maskBox=this._blockBox.slice(0),this._mask=this._offsets.reduce(function(M,x){for(var z,L=1;L<=g;L++){z=w===l?L%2===1:L%2===0;var S={"xlink:href":"#"+C+L,x:r(x[0]),y:r(x[1])};z&&(S.fill="#fff",S.stroke="#fff"),M.push(s("use",S))}return M},[]),u=this._finishClearLayer()}this._offsets=e,f?this._blockMode=c:(this._blockMode=u?_:l,this._blockCount++,this._blockLayerCount=0,this._blockBox=h.every(y)?h:[0,0,0,0])},i.prototype._handleSize=function(e,h){if(e.every(y)){var f=r(e[0]),u=r(e[1]),p=r(e[2]-e[0]),s=r(e[3]-e[1]);this.viewBox=[f,u,p,s],this.width=p/1e3,this.height=s/1e3,this.units=h}},i.prototype._draw=function(e){this._blockMode?this._block.push(e):this._maskId?this._mask.push(e):this.layer.push(e)},A=i,A}var E,W;function sr(){if(W)return E;W=1;var m=["id","attributes","defs","layer","viewBox","width","height","units"];return E=function(y){return m.reduce(function(b,n){var v=y[n];return v!=null&&(b[n]=y[n]),b},{})},E}var X;function dr(){if(X)return B.exports;X=1;var m=J(),a=Q(),y=V(),b=Y(),n=ir(),v=H(),k=sr(),t=function(r){typeof r=="string"?r={id:r}:r||(r={});var o={id:m.ensure(r.id),attributes:r.attributes||{},createElement:r.createElement||b,objectMode:r.objectMode==null?!1:r.objectMode,parser:{places:r.places,zero:r.zero,filetype:r.filetype},plotter:{units:r.units,backupUnits:r.backupUnits,nota:r.nota,backupNota:r.backupNota,optimizePaths:r.optimizePaths,plotAsOutline:r.plotAsOutline}};return o};return B.exports=function(o,d,c){typeof d=="function"&&(c=d,d=null);var l=t(d),_=c!=null,i=new n(l.id,l.attributes,l.createElement,l.objectMode),e=a(l.parser),h=y(l.plotter);if(i.parser=e,i.plotter=h,e.on("warning",function(s){i.emit("warning",s)}),h.on("warning",function(s){i.emit("warning",s)}),e.once("error",function(s){i.emit("error",s)}),h.once("error",function(s){i.emit("error",s)}),e.once("end",function(){i.filetype=e.format.filetype}),o.pipe?(o.setEncoding("utf8"),o.pipe(e)):process.nextTick(function(){e.write(o),e.end()}),e.pipe(h).pipe(i),_){var f="",u=function(){return c(null,f)};i.on("readable",function(){var s;do s=i.read()||"",f+=s;while(s)}),i.once("end",u),i.once("error",function(p){return i.removeListener("end",u),c(p)})}return i},B.exports.render=v,B.exports.clone=k,B.exports}export{dr as r};
