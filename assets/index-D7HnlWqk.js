var E=Object.defineProperty;var R=(d,e,t)=>e in d?E(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var w=(d,e,t)=>R(d,typeof e!="symbol"?e+"":e,t);import{a as f,j as m}from"./vendor-react-08UYt03A.js";import{c as C}from"./vendor-react-dom-C8YMDE6l.js";import{b as k}from"./vendor-buffer-Be-il6ZS.js";import{P as O}from"./vendor-pcb-stackup-CujRJLBJ.js";import{p as S}from"./vendor-process-Dx8qOcfY.js";import{J as P}from"./vendor-jszip-DA_35h81.js";import{W as z,S as A,P as N,O as B,A as G,a as M,T as U,B as I,M as L,b as T,c as F}from"./vendor-three-Ckw31WsC.js";import"./vendor-scheduler-BF-YhwgH.js";import"./vendor-base64-js-DRz5BQNA.js";import"./vendor-ieee754-vIlwft-x.js";import"./vendor-@tracespace-_ibhTgpc.js";import"./vendor-xtend-VQg9yHl6.js";import"./vendor-run-parallel-CD1_Jmin.js";import"./vendor-queue-microtask-k88_duEE.js";import"./vendor-run-waterfall-caUdQ7AG.js";import"./vendor-gerber-to-svg-DFKxK_0l.js";import"./vendor-gerber-parser-ClboYFFq.js";import"./vendor-lodash.isfinite-1y0ymm8B.js";import"./vendor-string_decoder-DZPR7MxD.js";import"./vendor-safe-buffer-DcNHIamD.js";import"./vendor-inherits-BICa84dG.js";import"./vendor-readable-stream-Bo7DI6DN.js";import"./vendor-events-DQ172AOg.js";import"./vendor-util-deprecate-B2OF2CkE.js";import"./vendor-lodash.padstart-N4jo84Bx.js";import"./vendor-lodash.padend-C_7kNAQY.js";import"./vendor-gerber-plotter-BPlChmpN.js";import"./vendor-lodash.fill-DjFi-7ML.js";import"./vendor-lodash.isfunction-DOfGYLuz.js";import"./vendor-xml-element-string-4eagscF3.js";import"./vendor-escape-html-CnGJ826T.js";import"./vendor-pcb-stackup-core-DLlTdNNm.js";import"./vendor-whats-that-gerber-Drp5jgFj.js";import"./vendor-viewbox-IwQ9f3jH.js";import"./vendor-color-string-DcuAIlqQ.js";import"./vendor-color-name-Dju3oUBS.js";import"./vendor-simple-swizzle-3gX0Onlb.js";import"./vendor-is-arrayish-DyGeW-O8.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(r){if(r.ep)return;r.ep=!0;const c=t(r);fetch(r.href,c)}})();window.process=S;const W=d=>{const[e,t]=f.useState(),[i,r]=f.useState(1);f.useEffect(()=>{c()},[d]);const c=async()=>{if(d===void 0)return;console.log({gerberFiles:d});const l=u(d);console.log({layers:l});const n=await O(l);console.log({pcb:n});const a=await h(n.top),s=await h(n.bottom);console.log({top:a,bottom:s}),t({top:a,bottom:s})},u=l=>{let n=[];for(const a of Object.keys(l)){const{type:s,side:y}=o(a);n=[...n,{type:s,side:y,gerber:k.Buffer.from(l[a]),filename:a}]}return n},o=l=>{let n=null,a=null;const s=l.toLowerCase().split(/_|-|\./);switch(s[s.length-1]){case"gtl":return{type:"copper",side:"top"};case"gto":return{type:"silkscreen",side:"top"};case"gtp":return{type:"solderpaste",side:"top"};case"gts":return{type:"soldermask",side:"top"};case"gbl":return{type:"copper",side:"bottom"};case"gbo":return{type:"silkscreen",side:"bottom"};case"gbp":return{type:"solderpaste",side:"bottom"};case"gbs":return{type:"soldermask",side:"bottom"};case"gko":return{type:"outline",side:"all"};case"drl":return{type:"drill",side:"all"}}return s.find(p=>p.includes("edge"))||s.find(p=>p.includes("outline"))?{type:"outline",side:"all"}:(s.includes("sm")||s.find(p=>p.includes("mask"))?n="soldermask":s.includes("sp")||s.find(p=>p.includes("paste"))?n="solderpaste":s.includes("ss")||s.find(p=>p.includes("silk"))?n="silkscreen":s.includes("cu")&&(n="copper"),s.find(p=>p.startsWith("in"))?a="inner":s.includes("f")||s.find(p=>p.includes("top"))?a="top":(s.includes("b")||s.find(p=>p.includes("bottom")))&&(a="bottom"),a=="inner"&&!n&&(n="copper"),{type:n,side:a})},h=l=>(console.log({model:l}),new Promise(n=>{const{width:a,height:s}=g(l),y=new Blob([l.svg],{type:"image/svg+xml;charset=utf-8"}),p=URL.createObjectURL(y),v=new Image;v.onload=function(){const x=document.createElement("canvas");x.width=a,x.height=s,x.getContext("2d").drawImage(v,0,0,a,s);const j=x.toDataURL("image/png");n(j),URL.revokeObjectURL(p)},v.src=p})),g=l=>{const n=l.width/l.height;r(n);const a=512,s=l.height=512/n;return{width:a,height:s}};return{gerberImg:e,ratio:i}},D=["gtl","gto","gtp","gts","gbl","gbo","gbp","gbs","gko","drl"],H=["a","b","c","d","e"],$=()=>{const[d,e]=f.useState();f.useEffect(()=>{t()},[]);const t=async()=>{const o=i();o!==null&&await r(o)},i=()=>{const o=window.location.search,g=new URLSearchParams(o).get("gerber");return console.log({gerber:g}),g},r=async o=>{const h=await c(o);await u(h)},c=async o=>{const g=await(await fetch(o)).arrayBuffer(),n=await new P().loadAsync(g);let a=[];for(const s of Object.values(n.files))a=[...a,s];return a},u=async o=>{let h={};for(const g of o){const l=g.name,n=l.toLowerCase().split(/_|-|\./),a=n[n.length-1];if(D.includes(a)){const s=await g.async("uint8array");h[l]=s}}e(h)};return{gerberFiles:d,setLink:r}},_={light:16777215,specular:13421772,pcbColor:2445317,indentStart:"#E4E4E7",indentEnd:"#A1A1AA"};class q{constructor(e){w(this,"renderer",new z);w(this,"scene",new A);w(this,"camera");w(this,"id");w(this,"animate",()=>{const e=requestAnimationFrame(this.animate);return this.renderer.render(this.scene,this.camera),e});this.init(e),this.setCamera(e),this.setLight(),this.id=this.animate()}get getRendererDom(){return this.renderer.domElement}dispose(){cancelAnimationFrame(this.id)}init({width:e,height:t}){this.renderer.setSize(e,t),this.scene.background=this.getBackground()}setCamera({width:e,height:t}){this.camera=new N(75,e/t,.1,1e3),this.camera.position.z=5}setOrbitControl(e){new B(this.camera,e)}setLight(){const e=new G(_.light,1);this.scene.add(e);const t=new M(_.light,.3);this.camera.add(t),this.scene.add(this.camera)}async makeObj(e,t){if(t===void 0)return;const i=new U,r=await i.loadAsync(t.top),c=await i.loadAsync(t.bottom);c.rotation=Math.PI,c.center.set(.5,.5);const u={shininess:80,specular:_.specular},o=new I(3,.05,3/e),h=new L({...u,color:_.pcbColor}),g=new L({...u,map:r,transparent:!0}),l=new L({...u,map:c,transparent:!0}),n=new T(o,[h,h,g,l,h,h]);this.scene.add(n)}getBackground(){const e=document.createElement("canvas"),t=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight;const i=t.createLinearGradient(0,0,0,e.height);i.addColorStop(0,_.indentStart),i.addColorStop(.4,_.indentEnd),t.fillStyle=i,t.fillRect(0,0,e.width,e.height);const r=new F(e);return r.needsUpdate=!0,r}setResizeHandler(e){const t=e.clientWidth,i=e.clientHeight;this.renderer.setSize(t,i),this.camera.aspect=t/i,this.camera.updateProjectionMatrix()}}const J=()=>{const{gerberFiles:d,setLink:e}=$(),{ratio:t,gerberImg:i}=W(d),[r,c]=f.useState(!0),u=f.useRef(null);return f.useEffect(()=>{let o;const h=()=>{o&&o.setResizeHandler(u.current)};if(i){const g={width:window.innerWidth,height:window.innerHeight};o=new q(g),o.setOrbitControl(u.current),o.makeObj(t,i),u.current.appendChild(o.getRendererDom),window.onresize=h,c(!1)}return()=>{o==null||o.dispose(),window.onresize=null}},[i]),{ref:u,setLink:e,isLoading:r,hasGerber:d!==void 0}},V="_div_container_u3628_1",X="_label_file_u3628_10",K="_img_upload_u3628_30",Z="_btn_hover_u3628_1",Q="_input_path_u3628_40",Y="_p_info_u3628_46",ee="_div_example_u3628_51",b={div_container:V,label_file:X,img_upload:K,btn_hover:Z,input_path:Q,p_info:Y,div_example:ee},te=({onClickExample:d})=>{const e=t=>{t.preventDefault()};return m.jsxs("div",{className:b.div_container,children:[m.jsx("h1",{children:"Welcome to gerber 3d viewer beta version"}),m.jsxs("label",{className:b.label_file,onClick:e,children:[m.jsxs("div",{className:b.div_upload_btn,children:["Click here to upload file",m.jsx("img",{className:b.img_upload,width:30,height:30,src:"/icon/upload.svg"})]}),m.jsx("p",{children:"Or"}),m.jsx("div",{children:"Drag gerber file in box"}),m.jsx("p",{children:"Or"}),m.jsxs("div",{children:["Enter gerber zip url here",m.jsx("input",{className:b.input_path,placeholder:"Enter gerber zip"})]}),m.jsx("p",{className:b.p_info,children:"(Only zip file is supported now)"})]}),m.jsx("div",{className:b.div_example,children:H.map((t,i)=>m.jsx("img",{src:`/${t}/image.png`,onClick:()=>d(`/${t}/gerber.zip`)},`ex-${i}`))})]})},se="_main_xrkvf_1",re={main:se},ne=()=>{const{isLoading:d,hasGerber:e,setLink:t,ref:i}=J();return m.jsx(m.Fragment,{children:m.jsx("div",{className:re.main,ref:i,children:!e&&m.jsx(te,{onClickExample:t})})})};C.createRoot(document.getElementById("root")).render(m.jsx(ne,{}));
