import{r as ar}from"./vendor-lodash.isfinite-1y0ymm8B.js";import{r as Sr}from"./vendor-string_decoder-DZPR7MxD.js";import{r as Br}from"./vendor-inherits-BICa84dG.js";import{r as Ur}from"./vendor-readable-stream-Bo7DI6DN.js";import{r as Xr}from"./vendor-lodash.padstart-N4jo84Bx.js";import{r as Yr}from"./vendor-lodash.padend-C_7kNAQY.js";var b,ur;function $r(){if(ur)return b;ur=1;var f=function(a,p,g){for(var d=Math.min(g-p,a.length),i=[],s=null,v=-1;!s&&++v<d;){var h=a[v];h===`
`?i.length+v&&(s="drill",i=[]):(i.push(h),h==="*"&&i[0]!==";"&&(s="gerber",i=[]))}return s};return b=f,b}var j,or;function Zr(){if(or)return j;or=1;var f=function(a,p,g){if(a!=="gerber"&&a!=="drill")throw new Error('filetype to get next block must be "drill" or "gerber"');for(var d=p.length-g,i=a==="gerber"?"*":`
`,s=a==="gerber"?"%":"",v=!1,h=!1,_=!1,R=!1,n=[],r=0,t=0;!R&&r<d;){var c=p[g+r];c===`
`&&t++,c===s?h?(_=!0,n.pop()):(h=!0,n.push(c)):c===i?(v=!0,h&&n.push(c)):c>=" "&&c<="~"&&n.push(c),r++,R=v&&(!h||_)}var w=R?n.join("").trim():"",A=R?"":n.join("");return{lines:t,read:r,block:w,rem:A}};return j=f,j}var H,vr;function gr(){if(vr)return H;vr=1;var f=function(v){return{type:"done",line:v||-1}},a=function(v,h,_){return{type:"set",line:_||-1,prop:v,value:h}},p=function(v,h,_){return{type:"level",line:_||-1,level:v,value:h}},g=function(v,h,_){return{type:"tool",line:_||-1,code:v,tool:h}},d=function(v,h,_){return{type:"op",line:_||-1,op:v,coord:h}},i=function(v,h,_){return{type:"macro",line:_||-1,name:v,blocks:h}},s={set:a,done:f,level:p,tool:g,op:d,macro:i};return H=s,H}var V,fr;function nr(){if(fr)return V;fr=1;var f=ar(),a=Xr(),p=Yr(),g=function(d,i){if(d==null)return NaN;var s=""+d,v="+";(s[0]==="-"||s[0]==="+")&&(v=s[0],s=s.slice(1));var h=s.indexOf(".")!==-1;if(h||i==null||i.zero==null)return Number(v+s);if(i.places==null||i.places.length!==2)return NaN;var _=i.places[0],R=i.places[1];if(!f(_)||!f(R))return NaN;if(i.zero==="T")s=p(s,_+R,"0");else if(i.zero==="L")s=a(s,_+R,"0");else return NaN;var n=s.slice(0,_),r=s.slice(_,_+R);return+(v+n+"."+r)};return V=g,V}var J,lr;function yr(){if(lr)return J;lr=1;var f=nr(),a=/[XY]0\d+/,p=/[XY]\d+0(?=\D|$)/,g=[{coord:"x",test:/X([+-]?[\d.]+)/},{coord:"y",test:/Y([+-]?[\d.]+)/},{coord:"i",test:/I([+-]?[\d.]+)/},{coord:"j",test:/J([+-]?[\d.]+)/},{coord:"a",test:/A([\d.]+)/}],d=function(s,v){if(s==null)return{};if(v.zero==null||v.places==null)throw new Error("cannot parse coordinate with format undefined");var h=g.reduce(function(_,R){var n=s.match(R.test);return n&&(_[R.coord]=f(n[1],v)),_},{});return h},i=function(s){return p.test(s)?"L":a.test(s)?"T":null};return J={parse:d,detectZero:i},J}var K,hr;function br(){if(hr)return K;hr=1;var f=/[+\-/xX()]/,a=/[$\d.]+/,p=new RegExp([f.source,a.source].join("|"),"g");return K=function(d,i){var s=i.match(p),v,h=function(){var r=s.shift(),t;return a.test(r)?t={type:"n",val:r}:(t=v(),s.shift()),t},_=function(){var r=h(),t=s[0];for(t==="X"&&(d._warn("multiplication in macros should use 'x', not 'X'"),t="x");t==="x"||t==="/";){s.shift();var c=h();r={type:t,left:r,right:c},t=s[0]}return r};v=function(){for(var r=_(),t=s[0];t==="+"||t==="-";){s.shift();var c=_();r={type:t,left:r,right:c},t=s[0]}return r};var R=v(),n=function(r,t){var c=function(A){return A[0]==="$"?Number(t[A]):Number(A)},w=r.type;return w==="n"?c(r.val):w==="+"?n(r.left,t)+n(r.right,t):w==="-"?n(r.left,t)-n(r.right,t):w==="x"?n(r.left,t)*n(r.right,t):n(r.left,t)/n(r.right,t)};return function(r){return n(R,r)}},K}var W,_r;function jr(){if(_r)return W;_r=1;var f=br(),a=/^-?[\d.]+$/,p=/^(\$[\d+])=(.+)/,g=function(d,i){if(i[0]==="0")return{type:"comment"};if(p.test(i)){var s=i.match(p),v=s[1],h=s[2],_=f(d,h),R=function(w){return w[v]=_(w),w};return{type:"variable",set:R}}var n=function(w){return a.test(w)?Number(w):f(d,w)},r=i.split(",").map(n),t=r[0],c=r[1];if(t===1)return{type:"circle",exp:c,dia:r[2],cx:r[3],cy:r[4],rot:r[5]||0};if(t===2&&d._warn("macro aperture vector primitives with code 2 are deprecated"),t===2||t===20)return{type:"vect",exp:c,width:r[2],x1:r[3],y1:r[4],x2:r[5],y2:r[6],rot:r[7]};if(t===21)return{type:"rect",exp:c,width:r[2],height:r[3],cx:r[4],cy:r[5],rot:r[6]};if(t===22)return d._warn("macro aperture lower-left rectangle primitives are deprecated"),{type:"rectLL",exp:c,width:r[2],height:r[3],x:r[4],y:r[5],rot:r[6]};if(t===4)return{type:"outline",exp:c,points:r.slice(3,-1),rot:r[r.length-1]};if(t===5)return{type:"poly",exp:c,vertices:r[2],cx:r[3],cy:r[4],dia:r[5],rot:r[6]};if(t===6)return{type:"moire",exp:1,cx:r[1],cy:r[2],dia:r[3],ringThx:r[4],ringGap:r[5],maxRings:r[6],crossThx:r[7],crossLen:r[8],rot:r[9]};if(t===7)return{type:"thermal",exp:1,cx:r[1],cy:r[2],outerDia:r[3],innerDia:r[4],gap:r[5],rot:r[6]};d._warn(t+" is an unrecognized primitive for a macro aperture")};return W=g,W}var Q,cr;function Hr(){if(cr)return Q;cr=1;var f=gr(),a=nr(),p=yr(),g=jr(),d=/^G0*([123])/,i=/^G3([67])/,s=/^G7([45])/,v=/^G7([01])/,h=/^G9([01])/,_=/^G0*4/,R=/^%TO[^%*]*/,n=/^(?:G54)?D0*([1-9]\d+)/,r=/D0*([123])$/,t=/^(?:G0*[123])?((?:[XYIJ][+-]?\d+){1,4})(?:D0*[123])?$/,c=/^%MO(IN|MM)/,w=/^%FS([LT]?)([AI]?)(.*)X([0-7])([0-7])Y\4\5/,A=/^%LP([CD])/,G=/^%SR(?:X(\d+)Y(\d+)I([\d.]+)J([\d.]+))?/,C=/^%ADD0*(\d{2,})([A-Za-z_$][\w\-.]*)(?:,((?:X?[\d.-]+)*))?/,D=/^%AM([A-Za-z_$][\w\-.]*)\*?(.*)/,P=/\*MO(IN|MM)$/,e=function(u,o){var E=o==="IN"?"in":"mm";return u._push(f.set("units",E))},l=function(u,o){var E={places:u.format.places},T=o.match(C),O=T[1],L=T[2],N=T[3]?T[3].split("X"):[],x,M;L==="C"?(x="circle",M=3):L==="R"?(x="rect",M=4):L==="O"?(x="obround",M=4):L==="P"?(x="poly",M=5):(x=L,M=0);var I;x==="circle"?I=[a(N[0],E)]:x==="rect"||x==="obround"?I=[a(N[0],E),a(N[1],E)]:x==="poly"?(I=[a(N[0],E),Number(N[1]),0],N[2]&&(I[2]=Number(N[2]))):I=N.map(Number);var q=[];N[M-1]?q=[a(N[M-2],E),a(N[M-1],E)]:N[M-2]&&(q=[a(N[M-2],E)]);var U={shape:x,params:I,hole:q};return u._push(f.tool(O,U))},m=function(u,o){var E=o.match(D),T=E[1];T.match(/-/)&&u._warn("hyphens in macro name are illegal: "+T);var O=E[2].length?E[2].split("*"):[],L=O.filter(Boolean).map(function(N){return g(u,N)});return u._push(f.macro(T,L))},y=function(u,o){if(!(_.test(o)||R.test(o))){if(o==="M02")return u._push(f.done());if(i.test(o)){var E=o.match(i)[1],T=E==="6";return u._push(f.set("region",T))}if(s.test(o)){var O=o.match(s)[1],L=O==="4"?"s":"m";return u._push(f.set("arc",L))}if(c.test(o)){var N=o.match(c)[1];return e(u,N)}if(v.test(o)){var x=o.match(v)[1],M=x==="0"?"in":"mm";return u._push(f.set("backupUnits",M))}if(w.test(o)){var I=o.match(w),q=I[1],U=I[2],sr=I[3],wr=Number(I[4]),Tr=Number(I[5]),z=u.format;z.zero=z.zero||q,z.places||(z.places=[wr,Tr]),z.zero?z.zero==="T"&&u._warn("trailing zero suppression has been deprecated"):(z.zero="L",u._warn("zero suppression missing from format; assuming leading")),sr&&u._warn('unknown characters "'+sr+'" in "'+o+'" were ignored');var xr=1.5*Math.pow(10,-z.places[1]);if(u._push(f.set("nota",U)),u._push(f.set("epsilon",xr)),P.test(o)){var Mr=o.match(P)[1];e(u,Mr)}return}if(h.test(o)){var Lr=o.match(h)[1],Ir=Lr==="0"?"A":"I";return u._push(f.set("backupNota",Ir))}if(A.test(o)){var Ar=o.match(A)[1];return u._push(f.level("polarity",Ar))}if(G.test(o)){var F=o.match(G),zr=F[1]||1,Or=F[2]||1,Cr=F[3]||0,Dr=F[4]||0,qr={x:Number(zr),y:Number(Or),i:Number(Cr),j:Number(Dr)};return u._push(f.level("stepRep",qr))}if(n.test(o)){var Gr=o.match(n)[1];return u._push(f.set("tool",Gr))}if(C.test(o))return l(u,o);if(D.test(o))return m(u,o);if(r.test(o)||d.test(o)||t.test(o)){var X=o.match(r),Y=o.match(d),$=o.match(t),S;if(Y&&(Y[1]==="1"?S="i":Y[1]==="2"?S="cw":S="ccw",u._push(f.set("mode",S))),X||$){var Z=X?X[1]:"",Pr=$?$[1]:"",Fr=p.parse(Pr,u.format),B="last";Z==="1"?B="int":Z==="2"?B="move":Z==="3"&&(B="flash"),u._push(f.op(B,Fr))}return}return u._warn('block "'+o+'" was not recognized and was ignored')}};return Q=y,Q}var k,mr;function Nr(){return mr||(mr=1,k={DRILL:"5",MOVE:"0",LINEAR:"1",CW_ARC:"2",CCW_ARC:"3"}),k}var rr,pr;function Vr(){if(pr)return rr;pr=1;var f=ar(),a=gr(),p=Nr(),g=nr(),d=yr(),i=/;FILE_FORMAT=(\d):(\d)/,s=/;TYPE=(PLATED|NON_PLATED)/,v=/;FORMAT={(.):(.)\/ (absolute|.+)? \/ (metric|inch) \/.+(trailing|leading|decimal|keep)/,h=/^(INCH|METRIC|M71|M72)/,_=/,([TL])Z/,R=/,(0{1,8})\.(0{1,8})/,n=/T0*(\d+)[\S]*C([\d.]+)/,r=/T0*(\d+)(?![\S]*C)/,t=/((?:[XYIJA][+-]?[\d.]+){1,4})(?:G85((?:[XY][+-]?[\d.]+){1,2}))?/,c=/^G0([01235])/,w=function(e,l,m){var y={};if(v.test(l)){var u=l.match(v),o=Number(u[1]),E=Number(u[2]),T=u[3],O=u[4],L=u[5];f(o)&&f(E)&&(y.places=[o,E]),T==="absolute"?e._push(a.set("backupNota","A",m)):e._push(a.set("backupNota","I",m)),O==="metric"?e._push(a.set("backupUnits","mm",m)):e._push(a.set("backupUnits","in",m)),L==="leading"||L==="keep"?y.zero="L":L==="trailing"?y.zero="T":y.zero="D"}else if(i.test(l)){var N=l.match(i);y.places=[Number(N[1]),Number(N[2])]}else if(s.test(l)){var x=l.match(s),M=x[1]==="PLATED"?"pth":"npth";e._push(a.set("holePlating",M,m))}return y},A=function(e,l,m){var y=l.match(h),u=l.match(_),o=l.match(R),E=y[1]==="METRIC"||y[1]==="M71"?"mm":"in",T=u&&u[1];e.format.zero==null&&T&&(e.format.zero=T==="T"?"L":"T"),e.format.places==null&&(o?e.format.places=[o[1].length,o[2].length]:e.format.places=E==="in"?[2,4]:[3,3]),e._push(a.set("units",E,m))},G=function(e,l,m){var y=l.match(t),u=d.parse(y[1],e.format);if(y[2])return e._push(a.op("move",u,m)),e._push(a.set("mode","i",m)),u=d.parse(y[2],e.format),e._push(a.op("int",u,m));switch(c.test(l)&&(e._drillMode=l.match(c)[1]),e._drillMode){case p.DRILL:return e._push(a.op("flash",u,m));case p.MOVE:return e._push(a.op("move",u,m));case p.LINEAR:return e._push(a.set("mode","i",m)),e._push(a.op("int",u,m));case p.CW_ARC:return e._push(a.set("mode","cw",m)),e._push(a.op("int",u,m));case p.CCW_ARC:return e._push(a.set("mode","ccw",m)),e._push(a.op("int",u,m))}},C=function(e,l,m){if(n.test(l)){var y=l.match(n),u=y[1],o=g(y[2]),E={shape:"circle",params:[o],hole:[]};return e._push(a.tool(u,E,m))}if(r.test(l)){var T=l.match(r)[1];e._push(a.set("tool",T,m))}if(t.test(l))return e.format.places||(e.format.places=[2,4],e._warn("places format missing; assuming [2, 4]")),e.format.zero||(e.format.zero="T",e._warn("zero suppression missing; assuming trailing suppression")),G(e,l,m);if(l==="M00"||l==="M30")return e._push(a.done(m));if(l==="G90")return e._push(a.set("nota","A",m));if(l==="G91")return e._push(a.set("nota","I",m));if(h.test(l))return A(e,l,m)},D=function(e){e._drillStash.forEach(function(l){C(e,l.block,l.line)}),e._drillStash=[]},P=function(e,l){if(l[0]===";"){var m=w(e,l,e.line);Object.keys(m).forEach(function(y){e.format[y]||(e.format[y]=m[y])})}else e.format.zero?C(e,l,e.line):(e._drillStash.push({line:e.line,block:l}),t.test(l)&&(e.format.zero=d.detectZero(l),e.format.zero&&e._warn("zero suppression missing; detected "+(e.format.zero==="L"?"leading":"trailing")+" suppression")),(e.format.zero||_.test(l)||e._drillStash.length>=1e3)&&D(e))};return rr={parse:P,flush:D},rr}var er,dr;function Jr(){if(dr)return er;dr=1;var f=function(a,p){return{message:a,line:p}};return er=f,er}var tr,Rr;function Kr(){if(Rr)return tr;Rr=1;var f=Sr().StringDecoder,a=Br(),p=Ur().Transform,g=$r(),d=Zr(),i=Hr(),s=Vr(),v=Jr(),h=Nr(),_=65535,R=function(n,r,t){p.call(this,{readableObjectMode:!0}),this._decoder=new f("utf8"),this._stash="",this._index=0,this._drillMode=h.DRILL,this._drillStash=[],this._syncResult=null,this.line=0,this.format={places:n,zero:r,filetype:t}};return a(R,p),R.prototype._process=function(n,r){for(;this._index<n.length;){var t=d(r,n,this._index);this._index+=t.read,this.line+=t.lines,this._stash+=t.rem,t.block&&(r==="gerber"?i(this,t.block):s.parse(this,t.block))}},R.prototype._transform=function(n,r,t){var c=this.format.filetype;if(n=this._decoder.write(n),!c)if(c=g(n,this._index,_),this._index+=n.length,c)this.format.filetype=c,this._index=0;else return this._index>=_?t(new Error("unable to determine filetype")):(this._stash+=n,t());n=this._stash+n,this._stash="",this._process(n,c),this._index=0,t()},R.prototype._flush=function(n){return this.format.filetype==="drill"&&s.flush(this),n&&n()},R.prototype._push=function(n){n.line===-1&&(n.line=this.line);var r=this._syncResult?this._syncResult:this;r.push(n)},R.prototype._warn=function(n){this.emit("warning",v(n,this.line))},R.prototype.parseSync=function(n){var r=g(n,this._index,100*_);return this.format.filetype=r,this._syncResult=[],this._process(n,r),this._flush(),this._syncResult},tr=R,tr}var ir,Er;function ie(){if(Er)return ir;Er=1;var f=ar(),a=Kr(),p=function(i){if(Array.isArray(i)&&i.length===2&&f(i[0])&&f(i[1]))return i;throw new Error("places must be an array of two whole numbers")},g=function(i){if(i==="T"||i==="L")return i;throw new Error("zero suppression must be 'L' or 'T'")},d=function(i){if(i==="gerber"||i==="drill")return i;throw new Error('filetype must be "drill" or "gerber"')};return ir=function(i){i=i||{};var s=i.places?p(i.places):null,v=i.zero?g(i.zero):null,h=i.filetype?d(i.filetype):null;return new a(s,v,h)},ir}export{ie as r};
