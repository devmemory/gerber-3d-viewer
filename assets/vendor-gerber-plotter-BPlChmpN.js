import{r as V}from"./vendor-readable-stream-Bo7DI6DN.js";import{r as k}from"./vendor-inherits-BICa84dG.js";import{r as rr}from"./vendor-lodash.fill-DjFi-7ML.js";import{r as ar}from"./vendor-lodash.isfunction-DOfGYLuz.js";import{r as tr}from"./vendor-lodash.isfinite-1y0ymm8B.js";var B,Y;function er(){if(Y)return B;Y=1;var x=rr(),b=function(v,f){var c,M;for(M=0;M<v.length;M++)if(c=v[M],f(c))return c},w=function(v,f,c){var M=v.reduce(function(P,R){var T=_(f,R.position);return T<c&&T<P.distance?{point:R,distance:T}:P},{point:void 0,distance:1/0});return M.point},_=function(v,f){return Math.sqrt(Math.pow(v[0]-f[0],2)+Math.pow(v[1]-f[1],2))},g=function(v,f){return v[0]===f[0]&&v[1]===f[1]},E=function(v,f){return v.type==="line"&&(g(v.start,f.start)&&g(v.end,f.end)||g(v.start,f.end)&&g(v.end,f.start))},m=function(v){var f={type:v.type,start:v.end,end:v.start};return v.type==="arc"&&(f.center=v.center,f.radius=v.radius,f.sweep=v.sweep,f.dir=v.dir==="cw"?"ccw":"cw"),f},y=function(v,f){this._edges=[],this._optimize=v,this._fillGaps=f,this.length=0};return y.prototype.add=function(v){var f={segment:v,start:v.start,end:v.end};this._edges.push(f),this.length++},y.prototype._fillGapsAndOptimize=function(){var v=this._edges.map(function(s){return s.segment});this._edges=[],this.length=0;for(var f=v.reduce(function(s,p){return s.concat([{position:p.start,edges:[]},{position:p.end,edges:[]}])},[]),c=v.length,M=0;M<c;M++){var P=v[M],R,T,t=this._fillGaps,a=M*2,n=a+1,i=f.slice(0,a).concat(f.slice(n+1));R=w(i,P.start,t),T=w(i,P.end,t),R?t&&(P.start=R.position):R={position:P.start,edges:[]},T?t&&(P.end=T.position):T={position:P.end,edges:[]};var u=b(this._edges,function(s){return E(s.segment,P)});if(!u){var r=this._edges.length,e={segment:P,start:R,end:T};f[a].edges.push(r),f[a].position=e.start.position,f[n].edges.push(r),f[n].position=e.end.position,this._edges.push(e),this.length++}}this._edges.forEach(function(s){f.forEach(function(p){g(p.position,s.start.position)&&(s.start.edges=s.start.edges.concat(p.edges)),g(p.position,s.end.position)&&(s.end.edges=s.end.edges.concat(p.edges))})})},y.prototype.traverse=function(){if(!this._optimize)return this._edges.map(function(a){return a.segment});this._fillGapsAndOptimize();for(var v=x(Array(this._edges.length),!1),f=[],c=[],M,P,R,T,t={position:[]};c.length<this._edges.length;)for(M=v.indexOf(!1),f.push(M);f.length;)M=f.pop(),v[M]||(v[M]=!0,P=this._edges[M],R=P.end,g(t.position,R.position)?(T=m(P.segment),t=P.start):(T=P.segment,t=P.end),t.edges.reverse().forEach(function(a){v[a]||f.push(a)}),c.push(T));return c},B=y,B}var F,S;function ir(){if(S)return F;S=1;var x=function(b,w){return{message:b,line:w}};return F=x,F}var G,W;function X(){if(W)return G;W=1;var x=function(){return[1/0,1/0,-1/0,-1/0]},b=function(m,y){return[Math.min(m[0],y[0]),Math.min(m[1],y[1]),Math.max(m[2],y[2]),Math.max(m[3],y[3])]},w=function(m,y){return[Math.min(m[0],y[0]),Math.min(m[1],y[1]),Math.max(m[2],y[0]),Math.max(m[3],y[1])]},_=function(m,y,v,f){return[Math.min(m[0],v-y),Math.min(m[1],f-y),Math.max(m[2],v+y),Math.max(m[3],f+y)]},g=function(m,y){var v=y[0],f=y[1];return[m[0]+v,m[1]+f,m[2]+v,m[3]+f]},E=function(m,y){return b(m,g(m,y))};return G={new:x,add:b,addPoint:w,addCircle:_,translate:g,repeat:E},G}var N,K;function nr(){if(K)return N;K=1;var x=ar(),b=tr(),w=X(),_=function(t){var a=Math.round(t*1e8)/1e8;return a===0?0:a},g=function(t){return t*Math.PI/180},E=function(t,a){a=g(a);var n=Math.sin(a),i=Math.cos(a),u=t[0],r=t[1];return[_(u*i-r*n),_(u*n+r*i)]},m=function(t,a,n,i){var u=t/2;if(a=a||0,n=n||0,i&&(a||n)){var r=E([a,n],i);a=r[0],n=r[1]}return{shape:{type:"circle",cx:a,cy:n,r:t/2},box:w.addCircle(w.new(),u,a,n)}},y=function(t,a,n,i,u,r){if(r){var e=E([t,a],r),s=E([n,i],r);t=e[0],a=e[1],n=s[0],i=s[1]}var p=(i-a)/(n-t),o=u/2,h=o,d=o;b(p)?(h*=p/Math.sqrt(1+Math.pow(p,2)),d*=1/Math.sqrt(1+Math.pow(p,2))):d=0;var l=[];l.push([_(t+h),_(a-d)]),l.push([_(n+h),_(i-d)]),l.push([_(n-h),_(i+d)]),l.push([_(t-h),_(a+d)]);var q=l.reduce(function(A,O){return w.addPoint(A,O)},w.new());return{shape:{type:"poly",points:l},box:q}},v=function(t,a,n,i,u,r){i=i||0,u=u||0,n=n||0,r=r||0;var e=t/2,s=a/2;if(r){var p=i-e,o=i+e,h=u,d=u;return y(p,h,o,d,a,r)}return{shape:{type:"rect",cx:i,cy:u,r:n,width:t,height:a},box:[-e+i,-s+u,e+i,s+u]}},f=function(t,a){for(var n=[],i=w.new(),u,r=0;r<t.length-2;r+=2)u=[t[r],t[r+1]],a&&(u=E(u,a)),n.push(u),i=w.addPoint(i,u);return{shape:{type:"poly",points:n},box:i}},c=function(t,a,n,i,u){i=i||0,u=u||0;for(var r=[],e=w.new(),s=t/2,p=n*Math.PI/180,o=2*Math.PI/a,h,d,l,q=0;q<a;q++)h=o*q+p,d=i+_(s*Math.cos(h)),l=u+_(s*Math.sin(h)),e=w.addPoint(e,[d,l]),r.push([d,l]);return{shape:{type:"poly",points:r},box:e}},M=function(t,a,n,i){return{type:"ring",cx:t,cy:a,r:n,width:i}},P=function(t,a,n,i,u,r,e,s,p){for(var o=t/2,h=[],d=w.addCircle(w.new(),o,e,s),l=a/2,q=n+l;o>a&&h.length<i;)o-=l,h.push(M(e,s,_(o),a)),o-=q;o>0&&h.length<i&&h.push(m(_(2*o),e,s).shape);var A=v(r,u,0,e,s,p),O=v(u,r,0,e,s,p);return h.push(A.shape),h.push(O.shape),d=w.add(d,A.box),d=w.add(d,O.box),{shape:h,box:d}},R=function(t,a,n,i,u,r){var e=_((n-u)/2),s=_((n+u)/4),p=_((n-i)/2),o=_((n-p)/2),h=w.addCircle(w.new(),n/2,t,a),d=[v(e,e,0,t+s,a+s,r).shape,v(e,e,0,t-s,a+s,r).shape,v(e,e,0,t-s,a-s,r).shape,v(e,e,0,t+s,a-s,r).shape],l=M(t,a,o,p);return{shape:{type:"clip",shape:d,clip:l},box:h}},T=function(t,a){var n={shape:[],box:w.new()},i=1;return a=a||[],a.reduce(function(u,r){var e;switch(r.type!=="variable"&&r.type!=="comment"&&(r=Object.keys(r).reduce(function(d,l){var q=r[l];return d[l]=A(q),d;function A(O){return Array.isArray(O)?O.map(A):x(O)?O(t):O}},{})),r.exp!=null&&r.exp!==i&&(u.shape.push({type:"layer",polarity:r.exp===1?"dark":"clear",box:u.box.slice(0)}),i=r.exp),r.type){case"circle":e=m(r.dia,r.cx,r.cy,r.rot);break;case"vect":e=y(r.x1,r.y1,r.x2,r.y2,r.width,r.rot);break;case"rect":e=v(r.width,r.height,0,r.cx,r.cy,r.rot);break;case"rectLL":var s=r.height/2,p=r.width/2,o=r.x+p,h=r.y+s;e=v(r.width,r.height,0,o,h,r.rot);break;case"outline":e=f(r.points,r.rot);break;case"poly":e=c(r.dia,r.vertices,r.rot,r.cx,r.cy);break;case"moire":e=P(r.dia,r.ringThx,r.ringGap,r.maxRings,r.crossThx,r.crossLen,r.cx,r.cy,r.rot);break;case"thermal":e=R(r.cx,r.cy,r.outerDia,r.innerDia,r.gap,r.rot);break;case"variable":return t=r.set(t),u;default:return u}return u.shape=u.shape.concat(e.shape),i===1&&(u.box=w.add(u.box,e.box)),u},n)};return N=function(a,n){var i=[],u=w.new(),r=a.shape,e=a.params,s,p;if(r==="circle")p=m(e[0]);else if(r==="rect")p=v(e[0],e[1]);else if(r==="obround")p=v(e[0],e[1],Math.min(e[0],e[1])/2);else if(r==="poly")p=c(e[0],e[1],e[2]);else{var o=e.reduce(function(h,d,l){return h["$"+(l+1)]=d,h},{});return T(o,n[r])}return i.push(p.shape),u=w.add(u,p.box),a.hole.length&&(s=a.hole.length===1?m(a.hole[0]).shape:v(a.hole[0],a.hole[1]).shape,i.push({type:"layer",polarity:"clear",box:u},s)),{shape:i,box:u}},N}var U,Z;function sr(){if(Z)return U;Z=1;var x=X(),b=Math.PI/2,w=Math.PI,_=Math.PI*2,g=3*Math.PI/2,E=function(t,a,n,i){return n?(i._warn("flash in region ignored"),x.new()):a?(a.flashed||(a.flashed=!0,i.push({type:"shape",tool:a.code,shape:a.pad})),i.push({type:"pad",tool:a.code,x:t[0],y:t[1]}),x.translate(a.box,t)):(i._warn("flash with unknown tool ignored"),x.new())},m=function(t,a,n,i,u){for(var r,e,s,p,o;o==null&&u.length>0;)p=u.pop(),r=Math.atan2(t[1]-p[1],t[0]-p[0]),e=Math.atan2(a[1]-p[1],a[0]-p[0]),n==="cw"?r=r>=e?r:r+_:e=e>=r?e:e+_,s=Math.abs(r-e),i==="s"?s<=b&&(o=p):o=p;if(o!=null)return r=r>=0?r:r+_,r=r<_?r:r-_,e=e>=0?e:e+_,e=e<_?e:e-_,{center:o,sweep:s,start:t.concat(r),end:a.concat(e)}},y=function(t,a,n,i,u){var r=t.start,e=t.end,s=t.center,p=t.sweep,o,h;u==="cw"?(o=e[2],h=r[2]):(o=r[2],h=e[2]);var d=[r,e];return(o>h||p===_)&&d.push([s[0]+a,s[1]]),o=o>=b?o-b:o+g,h=h>=b?h-b:h+g,(o>h||p===_)&&d.push([s[0],s[1]+a]),o=o>=b?o-b:o+g,h=h>=b?h-b:h+g,(o>h||p===_)&&d.push([s[0]-a,s[1]]),o=o>=b?o-b:o+g,h=h>=b?h-b:h+g,(o>h||p===_)&&d.push([s[0],s[1]-a]),d.reduce(function(l,q){if(!n){var A=x.translate(i.box,q);return x.add(l,A)}return x.addPoint(l,q)},x.new())},v=function(t,a){return t>=a?t:0},f=function(t,a,n,i,u){var r=n==="ccw"?1:-1,e=(t[0]+a[0])/2,s=(t[1]+a[1])/2,p=a[0]-t[1],o=a[1]-t[1],h=Math.sqrt(Math.pow(p,2)+Math.pow(o,2)),d=h/2,l=Math.sqrt(Math.pow(u,2)-Math.pow(d,2)),q=-r*o*l/h,A=r*p*l/h;return[[v(e+q,i),v(s+A,i)]]},c=function(t,a,n,i,u,r,e,s,p,o){var h=n[2]||Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)),d=[],l=[],q=[];n[0]&&r==="s"?l.push(t[0]+n[0],t[0]-n[0]):l.push(t[0]+n[0]),n[1]&&r==="s"?q.push(t[1]+n[1],t[1]-n[1]):q.push(t[1]+n[1]);for(var A=0;A<l.length;A++)for(var O=0;O<q.length;O++)d.push([l[A],q[O]]);var C;n[2]?(r="m",C=f(t,a,u,s,n[2])):r==="s"?C=d.filter(function(L){var Q=Math.sqrt(Math.pow(L[0]-t[0],2)+Math.pow(L[1]-t[1],2)),D=Math.sqrt(Math.pow(L[0]-a[0],2)+Math.pow(L[1]-a[1],2));return Math.abs(Q-h)<=s&&Math.abs(D-h)<=s}):C=d;var I=m(t,a,u,r,C);r==="m"&&t[0]===a[0]&&t[1]===a[1]&&(I.sweep=_);var z=x.new();return I!=null?(p.add({type:"arc",start:I.start,end:I.end,center:I.center,sweep:I.sweep,radius:h,dir:u}),z=y(I,h,e,i,u)):o._warn("skipping impossible arc"),z},M=function(t,a,n,i,u){if(u.add({type:"line",start:t,end:a}),!i){var r=x.translate(n.box,t),e=x.translate(n.box,a);return x.add(r,e)}var s=x.new();return s=x.addPoint(s,t),s=x.addPoint(s,a),s},P=function(t,a,n,i,u){var r=n.trace[0]/2,e=n.trace[1]/2,s=Math.atan2(a[1]-t[1],a[0]-t[0]),p=t[0]-r,o=t[0]+r,h=t[1]-e,d=t[1]+e,l=a[0]-r,q=a[0]+r,A=a[1]-e,O=a[1]+e,C=[];return t[0]===a[0]&&t[1]===a[1]?C.push([p,h],[o,h],[o,d],[p,d]):s>=0&&s<b?C.push([p,h],[o,h],[q,A],[q,O],[l,O],[p,d]):s>=b&&s<=w?C.push([o,h],[o,d],[q,O],[l,O],[l,A],[p,h]):s>=-w&&s<-b?C.push([o,d],[p,d],[l,O],[l,A],[q,A],[o,h]):C.push([p,d],[p,h],[l,A],[q,A],[q,O],[o,d]),C.forEach(function(I,z){var L=z<C.length-1?z+1:0;i.add({type:"line",start:I,end:C[L]})}),u._finishPath(),x.add(x.translate(n.box,t),x.translate(n.box,a))},R=function(t,a,n,i,u,r,e,s,p,o){var h=e||i&&i.trace.length>0,d=e||i&&i.trace.length===1,l=i?i.code:"[NO TOOL SET]";return h?u==="i"?e||i.trace.length===1?M(t,a,i,e,p):P(t,a,i,p,o):d?c(t,a,n,i,u,r,e,s,p,o):(o._warn("cannot draw arc with non-circular tool "+l+"; ignoring interpolate"),x.new()):(o._warn("tool "+l+" is not strokable; ignoring interpolate"),x.new())},T=function(t,a,n,i,u,r,e,s,p,o){var h=[a.x!=null?a.x:n[0],a.y!=null?a.y:n[1]],d=[a.i!=null?a.i:0,a.j!=null?a.j:0,a.a],l;switch(t){case"flash":l=E(h,i,e,o);break;case"int":l=R(n,h,d,i,u,r,e,p,s,o);break;default:l=x.new();break}return{pos:h,box:l}};return U=T,U}var j,$;function hr(){if($)return j;$=1;var x=V().Transform,b=k(),w=er(),_=ir(),g=nr(),E=sr(),m=X(),y=11e-5,v=function(c){return c==="units"||c==="backupUnits"||c==="nota"||c==="backupNota"},f=function(c,M,P,R,T,t){x.call(this,{readableObjectMode:!0,writableObjectMode:!0}),this.format={units:c,backupUnits:M||"in",nota:P,backupNota:R||"A"},this._formatLock={units:c!=null,backupUnits:M!=null,nota:P!=null,backupNota:R!=null},this._plotAsOutline=t===!0?y:t,(c||this.format.backupUnits)==="in"&&(this._plotAsOutline=this._plotAsOutline/25.4),this._optimizePaths=T||t,this._line=0,this._done=!1,this._tool=null,this._outTool=null,this._tools={},this._macros={},this._pos=[0,0],this._box=m.new(),this._mode=null,this._arc=null,this._region=!1,this._path=new w(this._optimizePaths,this._plotAsOutline),this._epsilon=null,this._lastOp=null,this._stepRep=[]};return b(f,x),f.prototype._finishPath=function(c){var M=this._path.traverse();if(this._path=new w(!c&&this._optimizePaths,this._plotAsOutline),M.length){var P=this._plotAsOutline?this._outTool:this._tool;!this._region&&P.trace.length===1?this.push({type:"stroke",width:P.trace[0],path:M}):this.push({type:"fill",path:M})}},f.prototype._warn=function(c){this.emit("warning",_(c,this._line))},f.prototype._checkFormat=function(){this.format.units||(this.format.units=this.format.backupUnits,this._warn("units not set; using backup units: "+this.format.units)),this.format.nota||(this.format.nota=this.format.backupNota,this._warn("notation not set; using backup notation: "+this.format.nota))},f.prototype._updateBox=function(c){var M=this._stepRep.length;if(!M)this._box=m.add(this._box,c);else{var P=m.repeat(c,this._stepRep[M-1]);this._box=m.add(this._box,P)}},f.prototype._transform=function(c,M,P){var R=c.type;if(this._line=c.line,this._done)return this._warn("ignoring extra command recieved after done command"),P();if(R==="op"){this._checkFormat();var T=c.op,t=c.coord;if(this.nota==="I"){var a=this;t=Object.keys(t).reduce(function(A,O){var C=t[O];return O==="x"?A[O]=a._pos[0]+C:O==="y"?A[O]=a._pos[1]+C:A[O]=C,A},{})}T==="last"&&(this._warn("modal operation commands are deprecated"),T=this._lastOp),T==="int"&&(this._mode==null&&(this._warn("no interpolation mode specified; assuming linear"),this._mode="i"),this._arc==null&&this._mode.slice(-2)==="cw"&&!t.a&&(this._warn("quadrant mode unspecified; assuming single quadrant"),this._arc="s")),this._plotAsOutline&&(this._outTool=this._tool);var n=E(T,t,this._pos,this._tool,this._mode,this._arc,this._region||this._plotAsOutline,this._path,this._epsilon,this);this._lastOp=T,this._pos=n.pos,this._updateBox(n.box)}else if(R==="set"){var i=c.prop,u=c.value;i==="region"?(this._finishPath(u),this._region=u):v(i)&&!this._formatLock[i]?(this.format[i]=u,(i==="units"||i==="nota")&&(this._formatLock[i]=!0)):i==="tool"?this._region?this._warn("cannot change tool while region mode is on"):this._tools[u]?this._outTool||(this._finishPath(),this._tool=this._tools[u]):this._warn("tool "+u+" is not defined"):this["_"+i]=u}else if(R==="tool"){var r=c.code,e=c.tool;this._tools[r]&&this._warn("tool "+r+" is already defined; overwriting definition");var s=g(e,this._macros),p={code:r,trace:[],pad:s.shape,flashed:!1,box:s.box};(e.shape==="circle"||e.shape==="rect")&&e.hole.length===0&&(p.trace=e.params),this._outTool||(this._finishPath(),this._tools[r]=p,this._tool=p)}else if(R==="macro")this._macros[c.name]=c.blocks;else if(R==="level"){var o=c.level,h=c.value;if(this._finishPath(),o==="polarity")this.push({type:"polarity",polarity:h==="C"?"clear":"dark",box:this._box.slice(0)});else{var d=[];if(h.x>1||h.y>1)for(var l=0;l<h.x;l++)for(var q=0;q<h.y;q++)d.push([l*h.i,q*h.j]);this._stepRep=d,this.push({type:"repeat",offsets:this._stepRep.slice(0),box:this._box.slice(0)})}}else R==="done"&&(this._done=!0);return P()},f.prototype._flush=function(c){this._finishPath(),this.push({type:"size",box:this._box,units:this.format.units}),c()},j=f,j}var H,J;function dr(){if(J)return H;J=1;var x=hr(),b=function(_){if(_==="A"||_==="I")return _;throw new Error('notation must be "in" or "mm"')},w=function(_){if(_==="in"||_==="mm")return _;throw new Error('units must be "in" or "mm"')};return H=function(g){g=g||{};var E=g.units?w(g.units):null,m=g.backupUnits?w(g.backupUnits):null,y=g.nota?b(g.nota):null,v=g.backupNota?b(g.backupNota):null;return new x(E,m,y,v,g.optimizePaths,g.plotAsOutline)},H}export{dr as r};
